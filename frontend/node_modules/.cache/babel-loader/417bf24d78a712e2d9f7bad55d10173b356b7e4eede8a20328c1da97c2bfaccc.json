{"ast":null,"code":"import _objectSpread from\"/Users/user/TuAppDeAccesorios/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _objectWithoutProperties from\"/Users/user/TuAppDeAccesorios/frontend/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";const _excluded=[\"executeWithErrorHandling\"],_excluded2=[\"executeWithErrorHandling\"];import{useState,useCallback}from'react';import{APIErrorHandler}from'../services/apiErrorHandler';import{useAuth}from'../context/AuthContext';import{getCachedProductsList,cacheProductsList,getCachedProductSearch,cacheProductSearch,invalidateProductsCache}from'../services/clientCache';/**\n * Hook personalizado para manejo de errores de API\n */export const useApiError=()=>{const[error,setError]=useState(null);const[isLoading,setIsLoading]=useState(false);const{logout}=useAuth();/**\n   * Maneja errores de API con lógica específica\n   */const handleApiError=useCallback(error=>{console.error('API Error:',error);// Si el error requiere reautenticación, cerrar sesión\nif(APIErrorHandler.requiresReauth(error)){logout();return;}// Configurar el error para mostrar al usuario\nsetError(error);},[logout]);/**\n   * Ejecuta una función async y maneja los errores automáticamente\n   */const executeWithErrorHandling=useCallback(async function(apiCall){let options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const{showError=true,onSuccess,onError}=options;setIsLoading(true);setError(null);try{const result=await apiCall();if(onSuccess){onSuccess(result);}return result;}catch(err){if(showError){handleApiError(err);}if(onError){onError(err);}return undefined;}finally{setIsLoading(false);}},[handleApiError]);/**\n   * Limpia el error actual\n   */const clearError=useCallback(()=>{setError(null);},[]);/**\n   * Verifica si un error es recuperable\n   */const isRecoverable=error?APIErrorHandler.isRecoverableError(error):false;/**\n   * Obtiene mensaje amigable del error\n   */const userMessage=error?APIErrorHandler.getUserFriendlyMessage(error):'';return{error,isLoading,handleApiError,executeWithErrorHandling,clearError,isRecoverable,userMessage};};/**\n * Hook específico para operaciones de productos\n */export const useProductsApi=()=>{const _useApiError=useApiError(),{executeWithErrorHandling}=_useApiError,errorState=_objectWithoutProperties(_useApiError,_excluded);const createProductWithErrorHandling=useCallback(async(productData,onSuccess)=>{const{createProduct}=await import('../services/api');return executeWithErrorHandling(()=>createProduct(productData),{onSuccess:()=>{// Invalidar caché de productos al crear uno nuevo\ninvalidateProductsCache();if(onSuccess)onSuccess();}});},[executeWithErrorHandling]);const updateProductWithErrorHandling=useCallback(async(productId,productData,onSuccess)=>{const{updateProduct}=await import('../services/api');return executeWithErrorHandling(()=>updateProduct(productId,productData),{onSuccess:()=>{// Invalidar caché de productos al actualizar uno\ninvalidateProductsCache();if(onSuccess)onSuccess();}});},[executeWithErrorHandling]);const getProductsWithErrorHandling=useCallback(async function(){let skip=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;let limit=arguments.length>1&&arguments[1]!==undefined?arguments[1]:20;// Intentar obtener del caché primero\nconst cachedResult=getCachedProductsList(skip,limit);if(cachedResult){return cachedResult;}const{getProducts}=await import('../services/api');return executeWithErrorHandling(async()=>{const result=await getProducts(skip,limit);// Cachear el resultado\nif(result){cacheProductsList(result.products,skip,limit);}return result;});},[executeWithErrorHandling]);const searchProductsWithErrorHandling=useCallback(async query=>{// Intentar obtener del caché primero\nconst cachedResult=getCachedProductSearch(query);if(cachedResult){return cachedResult;}const{searchProducts}=await import('../services/api');return executeWithErrorHandling(async()=>{const result=await searchProducts(query);// Cachear el resultado\nif(result){cacheProductSearch(query,result);}return result;},{showError:false}// No mostrar errores de búsqueda automáticamente\n);},[executeWithErrorHandling]);return _objectSpread(_objectSpread({},errorState),{},{createProduct:createProductWithErrorHandling,updateProduct:updateProductWithErrorHandling,getProducts:getProductsWithErrorHandling,searchProducts:searchProductsWithErrorHandling});};/**\n * Hook específico para operaciones de ventas\n */export const useSalesApi=()=>{const _useApiError2=useApiError(),{executeWithErrorHandling}=_useApiError2,errorState=_objectWithoutProperties(_useApiError2,_excluded2);const processSaleWithErrorHandling=useCallback(async(saleData,onSuccess)=>{const{postSale}=await import('../services/api');return executeWithErrorHandling(()=>postSale(saleData),{onSuccess:()=>{// Invalidar caché de productos al hacer una venta (cambia el stock)\ninvalidateProductsCache();if(onSuccess)onSuccess();}});},[executeWithErrorHandling]);return _objectSpread(_objectSpread({},errorState),{},{processSale:processSaleWithErrorHandling});};","map":{"version":3,"names":["useState","useCallback","APIErrorHandler","useAuth","getCachedProductsList","cacheProductsList","getCachedProductSearch","cacheProductSearch","invalidateProductsCache","useApiError","error","setError","isLoading","setIsLoading","logout","handleApiError","console","requiresReauth","executeWithErrorHandling","apiCall","options","arguments","length","undefined","showError","onSuccess","onError","result","err","clearError","isRecoverable","isRecoverableError","userMessage","getUserFriendlyMessage","useProductsApi","_useApiError","errorState","_objectWithoutProperties","_excluded","createProductWithErrorHandling","productData","createProduct","updateProductWithErrorHandling","productId","updateProduct","getProductsWithErrorHandling","skip","limit","cachedResult","getProducts","products","searchProductsWithErrorHandling","query","searchProducts","_objectSpread","useSalesApi","_useApiError2","_excluded2","processSaleWithErrorHandling","saleData","postSale","processSale"],"sources":["/Users/user/TuAppDeAccesorios/frontend/src/hooks/useApiError.ts"],"sourcesContent":["import { useState, useCallback } from 'react';\nimport { APIErrorHandler } from '../services/apiErrorHandler';\nimport { useAuth } from '../context/AuthContext';\nimport { \n  getCachedProductsList, \n  cacheProductsList, \n  getCachedProductSearch, \n  cacheProductSearch,\n  invalidateProductsCache \n} from '../services/clientCache';\n\n/**\n * Hook personalizado para manejo de errores de API\n */\nexport const useApiError = () => {\n  const [error, setError] = useState<Error | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const { logout } = useAuth();\n\n  /**\n   * Maneja errores de API con lógica específica\n   */\n  const handleApiError = useCallback((error: any) => {\n    console.error('API Error:', error);\n\n    // Si el error requiere reautenticación, cerrar sesión\n    if (APIErrorHandler.requiresReauth(error)) {\n      logout();\n      return;\n    }\n\n    // Configurar el error para mostrar al usuario\n    setError(error);\n  }, [logout]);\n\n  /**\n   * Ejecuta una función async y maneja los errores automáticamente\n   */\n  const executeWithErrorHandling = useCallback(async <T>(\n    apiCall: () => Promise<T>,\n    options: {\n      showError?: boolean;\n      onSuccess?: (result: T) => void;\n      onError?: (error: any) => void;\n    } = {}\n  ): Promise<T | undefined> => {\n    const { showError = true, onSuccess, onError } = options;\n\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const result = await apiCall();\n      \n      if (onSuccess) {\n        onSuccess(result);\n      }\n      \n      return result;\n    } catch (err: any) {\n      if (showError) {\n        handleApiError(err);\n      }\n      \n      if (onError) {\n        onError(err);\n      }\n      \n      return undefined;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [handleApiError]);\n\n  /**\n   * Limpia el error actual\n   */\n  const clearError = useCallback(() => {\n    setError(null);\n  }, []);\n\n  /**\n   * Verifica si un error es recuperable\n   */\n  const isRecoverable = error ? APIErrorHandler.isRecoverableError(error) : false;\n\n  /**\n   * Obtiene mensaje amigable del error\n   */\n  const userMessage = error ? APIErrorHandler.getUserFriendlyMessage(error) : '';\n\n  return {\n    error,\n    isLoading,\n    handleApiError,\n    executeWithErrorHandling,\n    clearError,\n    isRecoverable,\n    userMessage\n  };\n};\n\n/**\n * Hook específico para operaciones de productos\n */\nexport const useProductsApi = () => {\n  const { executeWithErrorHandling, ...errorState } = useApiError();\n\n  const createProductWithErrorHandling = useCallback(async (\n    productData: any,\n    onSuccess?: () => void\n  ) => {\n    const { createProduct } = await import('../services/api');\n    \n    return executeWithErrorHandling(\n      () => createProduct(productData),\n      {\n        onSuccess: () => {\n          // Invalidar caché de productos al crear uno nuevo\n          invalidateProductsCache();\n          if (onSuccess) onSuccess();\n        }\n      }\n    );\n  }, [executeWithErrorHandling]);\n\n  const updateProductWithErrorHandling = useCallback(async (\n    productId: number,\n    productData: any,\n    onSuccess?: () => void\n  ) => {\n    const { updateProduct } = await import('../services/api');\n    \n    return executeWithErrorHandling(\n      () => updateProduct(productId, productData),\n      {\n        onSuccess: () => {\n          // Invalidar caché de productos al actualizar uno\n          invalidateProductsCache();\n          if (onSuccess) onSuccess();\n        }\n      }\n    );\n  }, [executeWithErrorHandling]);\n\n  const getProductsWithErrorHandling = useCallback(async (\n    skip: number = 0,\n    limit: number = 20\n  ) => {\n    // Intentar obtener del caché primero\n    const cachedResult = getCachedProductsList(skip, limit);\n    if (cachedResult) {\n      return cachedResult;\n    }\n    \n    const { getProducts } = await import('../services/api');\n    \n    return executeWithErrorHandling(\n      async () => {\n        const result = await getProducts(skip, limit);\n        // Cachear el resultado\n        if (result) {\n          cacheProductsList(result.products, skip, limit);\n        }\n        return result;\n      }\n    );\n  }, [executeWithErrorHandling]);\n\n  const searchProductsWithErrorHandling = useCallback(async (query: string) => {\n    // Intentar obtener del caché primero\n    const cachedResult = getCachedProductSearch(query);\n    if (cachedResult) {\n      return cachedResult;\n    }\n    \n    const { searchProducts } = await import('../services/api');\n    \n    return executeWithErrorHandling(\n      async () => {\n        const result = await searchProducts(query);\n        // Cachear el resultado\n        if (result) {\n          cacheProductSearch(query, result);\n        }\n        return result;\n      },\n      { showError: false } // No mostrar errores de búsqueda automáticamente\n    );\n  }, [executeWithErrorHandling]);\n\n  return {\n    ...errorState,\n    createProduct: createProductWithErrorHandling,\n    updateProduct: updateProductWithErrorHandling,\n    getProducts: getProductsWithErrorHandling,\n    searchProducts: searchProductsWithErrorHandling\n  };\n};\n\n/**\n * Hook específico para operaciones de ventas\n */\nexport const useSalesApi = () => {\n  const { executeWithErrorHandling, ...errorState } = useApiError();\n\n  const processSaleWithErrorHandling = useCallback(async (\n    saleData: any,\n    onSuccess?: () => void\n  ) => {\n    const { postSale } = await import('../services/api');\n    \n    return executeWithErrorHandling(\n      () => postSale(saleData),\n      {\n        onSuccess: () => {\n          // Invalidar caché de productos al hacer una venta (cambia el stock)\n          invalidateProductsCache();\n          if (onSuccess) onSuccess();\n        }\n      }\n    );\n  }, [executeWithErrorHandling]);\n\n  return {\n    ...errorState,\n    processSale: processSaleWithErrorHandling\n  };\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}