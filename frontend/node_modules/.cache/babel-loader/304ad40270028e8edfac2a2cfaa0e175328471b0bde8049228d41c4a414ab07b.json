{"ast":null,"code":"import _objectSpread from\"/Users/user/TuAppDeAccesorios/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import Pagination from'../components/Pagination';import ErrorNotification from'../components/ErrorNotification';import{useProductsApi}from'../hooks/useApiError';import{useSkuValidation}from'../hooks/useSkuValidation';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const InventoryPage=()=>{const[products,setProducts]=useState([]);const[productListData,setProductListData]=useState(null);const[currentPage,setCurrentPage]=useState(1);const[itemsPerPage]=useState(10);const[newProduct,setNewProduct]=useState({sku:'',name:''});const[editingProduct,setEditingProduct]=useState(null);const[success,setSuccess]=useState(null);// Usar el hook de API con manejo de errores\nconst{error,isLoading,clearError,createProduct,updateProduct,getProducts}=useProductsApi();// Hook para validación de SKU en tiempo real\nconst skuValidation=useSkuValidation();const editSkuValidation=useSkuValidation(editingProduct===null||editingProduct===void 0?void 0:editingProduct.id);useEffect(()=>{fetchProducts();},[currentPage]);const fetchProducts=async()=>{const skip=(currentPage-1)*itemsPerPage;const data=await getProducts(skip,itemsPerPage);if(data){if(Array.isArray(data)){setProducts(data);setProductListData({products:data,total:data.length,skip:skip,limit:itemsPerPage,has_next:false});}else{setProductListData(data);setProducts(data.products);}}};const handleSkuChange=sku=>{setNewProduct(_objectSpread(_objectSpread({},newProduct),{},{sku}));skuValidation.validateSku(sku);};const handleEditSkuChange=sku=>{if(editingProduct){setEditingProduct(_objectSpread(_objectSpread({},editingProduct),{},{sku}));editSkuValidation.validateSku(sku);}};const handleCreateProduct=async e=>{e.preventDefault();setSuccess(null);// Verificar que el SKU esté disponible antes de crear\nif(skuValidation.isAvailable===false){return;// No permitir crear si el SKU no está disponible\n}await createProduct(newProduct,()=>{setSuccess(\"Producto creado con éxito.\");setNewProduct({sku:'',name:''});skuValidation.clearValidation();// Volver a la primera página después de crear\nif(currentPage!==1){setCurrentPage(1);}else{fetchProducts();}});};const handleUpdateProduct=async e=>{e.preventDefault();setSuccess(null);if(!editingProduct)return;// Verificar que el SKU esté disponible antes de actualizar\nif(editSkuValidation.isAvailable===false){return;// No permitir actualizar si el SKU no está disponible\n}await updateProduct(editingProduct.id,editingProduct,()=>{setSuccess(\"Producto actualizado con éxito.\");setEditingProduct(null);editSkuValidation.clearValidation();fetchProducts();});};const handlePageChange=page=>{setCurrentPage(page);setEditingProduct(null);// Cerrar edición al cambiar página\neditSkuValidation.clearValidation();// Limpiar validación al cambiar página\n};const totalPages=productListData?Math.ceil(productListData.total/itemsPerPage):1;return/*#__PURE__*/_jsxs(\"div\",{style:{padding:'20px'},children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Gesti\\xF3n de Inventario\"}),/*#__PURE__*/_jsx(ErrorNotification,{error:error,onClose:clearError}),success&&/*#__PURE__*/_jsx(\"div\",{style:{padding:'10px',backgroundColor:'#d4edda',border:'1px solid #c3e6cb',borderRadius:'4px',color:'#155724',marginBottom:'20px'},children:success}),/*#__PURE__*/_jsx(\"h2\",{children:\"Crear Nuevo Producto\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleCreateProduct,style:{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'10px',marginBottom:'20px'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{position:'relative'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"SKU (ej: CASE001)\",value:newProduct.sku,onChange:e=>handleSkuChange(e.target.value),style:{width:'100%',padding:'8px',border:\"2px solid \".concat(skuValidation.isValidating?'#ffc107':skuValidation.isAvailable===false?'#dc3545':skuValidation.isAvailable===true?'#28a745':'#ced4da'),borderRadius:'4px',fontSize:'14px'},required:true}),skuValidation.isValidating&&/*#__PURE__*/_jsx(\"small\",{style:{color:'#ffc107',display:'block',marginTop:'2px'},children:\"\\uD83D\\uDD0D Verificando SKU...\"}),skuValidation.isAvailable===false&&/*#__PURE__*/_jsxs(\"small\",{style:{color:'#dc3545',display:'block',marginTop:'2px'},children:[\"\\u274C \",skuValidation.message]}),skuValidation.isAvailable===true&&/*#__PURE__*/_jsxs(\"small\",{style:{color:'#28a745',display:'block',marginTop:'2px'},children:[\"\\u2705 \",skuValidation.message]}),skuValidation.error&&/*#__PURE__*/_jsxs(\"small\",{style:{color:'#dc3545',display:'block',marginTop:'2px'},children:[\"\\u26A0\\uFE0F \",skuValidation.error]})]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Nombre del Producto (ej: Funda iPhone 14)\",value:newProduct.name,onChange:e=>setNewProduct(_objectSpread(_objectSpread({},newProduct),{},{name:e.target.value})),required:true}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",placeholder:\"Precio Costo en COP (ej: 15000)\",value:newProduct.cost_price||'',onChange:e=>setNewProduct(_objectSpread(_objectSpread({},newProduct),{},{cost_price:e.target.value?parseFloat(e.target.value):undefined})),required:true}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",placeholder:\"Precio Venta en COP (ej: 25000)\",value:newProduct.selling_price||'',onChange:e=>setNewProduct(_objectSpread(_objectSpread({},newProduct),{},{selling_price:e.target.value?parseFloat(e.target.value):undefined})),required:true}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",placeholder:\"Cantidad en Stock (ej: 50)\",value:newProduct.stock_quantity||'',onChange:e=>setNewProduct(_objectSpread(_objectSpread({},newProduct),{},{stock_quantity:e.target.value?parseInt(e.target.value):undefined})),required:true}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:isLoading||skuValidation.isAvailable===false||skuValidation.isValidating,style:{padding:'8px 16px',backgroundColor:skuValidation.isAvailable===false?'#6c757d':'#007bff',color:'white',border:'none',borderRadius:'4px',cursor:skuValidation.isAvailable===false?'not-allowed':'pointer',opacity:skuValidation.isAvailable===false?0.6:1},children:isLoading?'Creando...':skuValidation.isAvailable===false?'SKU no disponible':'Crear Producto'})]}),/*#__PURE__*/_jsx(\"h2\",{children:\"Lista de Productos\"}),productListData&&/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'10px',fontSize:'14px',color:'#666'},children:[\"Mostrando \",products.length,\" de \",productListData.total,\" productos\"]}),isLoading&&/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',padding:'20px'},children:\"Cargando productos...\"}),/*#__PURE__*/_jsxs(\"table\",{style:{width:'100%',borderCollapse:'collapse'},children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{style:{backgroundColor:'#f8f9fa'},children:[/*#__PURE__*/_jsx(\"th\",{style:{border:'1px solid #ddd',padding:'12px',textAlign:'left'},children:\"SKU\"}),/*#__PURE__*/_jsx(\"th\",{style:{border:'1px solid #ddd',padding:'12px',textAlign:'left'},children:\"Nombre\"}),/*#__PURE__*/_jsx(\"th\",{style:{border:'1px solid #ddd',padding:'12px',textAlign:'right'},children:\"Costo (COP)\"}),/*#__PURE__*/_jsx(\"th\",{style:{border:'1px solid #ddd',padding:'12px',textAlign:'right'},children:\"Venta (COP)\"}),/*#__PURE__*/_jsx(\"th\",{style:{border:'1px solid #ddd',padding:'12px',textAlign:'right'},children:\"Stock\"}),/*#__PURE__*/_jsx(\"th\",{style:{border:'1px solid #ddd',padding:'12px',textAlign:'right'},children:\"Valor Stock (COP)\"}),/*#__PURE__*/_jsx(\"th\",{style:{border:'1px solid #ddd',padding:'12px',textAlign:'center'},children:\"Acciones\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:products.map(product=>/*#__PURE__*/_jsxs(\"tr\",{style:{backgroundColor:product.stock_quantity===0?'#fff3cd':'white'},children:[/*#__PURE__*/_jsx(\"td\",{style:{border:'1px solid #ddd',padding:'8px'},children:product.sku}),/*#__PURE__*/_jsxs(\"td\",{style:{border:'1px solid #ddd',padding:'8px'},children:[product.name,product.stock_quantity===0&&/*#__PURE__*/_jsx(\"span\",{style:{color:'#856404',fontSize:'12px',marginLeft:'5px'},children:\"(Sin stock)\"})]}),/*#__PURE__*/_jsxs(\"td\",{style:{border:'1px solid #ddd',padding:'8px',textAlign:'right'},children:[\"$\",product.cost_price.toLocaleString('es-CO')]}),/*#__PURE__*/_jsxs(\"td\",{style:{border:'1px solid #ddd',padding:'8px',textAlign:'right'},children:[\"$\",product.selling_price.toLocaleString('es-CO')]}),/*#__PURE__*/_jsx(\"td\",{style:{border:'1px solid #ddd',padding:'8px',textAlign:'right'},children:product.stock_quantity}),/*#__PURE__*/_jsxs(\"td\",{style:{border:'1px solid #ddd',padding:'8px',textAlign:'right'},children:[\"$\",(product.stock_quantity*product.cost_price).toLocaleString('es-CO')]}),/*#__PURE__*/_jsx(\"td\",{style:{border:'1px solid #ddd',padding:'8px',textAlign:'center'},children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>setEditingProduct(product),style:{padding:'6px 12px',backgroundColor:'#6c757d',color:'white',border:'none',borderRadius:'4px',cursor:'pointer'},disabled:isLoading,children:\"Editar\"})})]},product.id))})]}),/*#__PURE__*/_jsx(Pagination,{currentPage:currentPage,totalPages:totalPages,onPageChange:handlePageChange,disabled:isLoading}),editingProduct&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'20px',border:'1px solid #ccc',padding:'20px',borderRadius:'4px',backgroundColor:'#f8f9fa'},children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"Editar Producto: \",editingProduct.name]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleUpdateProduct,style:{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'10px'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{position:'relative'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"SKU (ej: CASE001)\",value:editingProduct.sku,onChange:e=>handleEditSkuChange(e.target.value),style:{width:'100%',padding:'8px',border:\"2px solid \".concat(editSkuValidation.isValidating?'#ffc107':editSkuValidation.isAvailable===false?'#dc3545':editSkuValidation.isAvailable===true?'#28a745':'#ced4da'),borderRadius:'4px',fontSize:'14px'},required:true}),editSkuValidation.isValidating&&/*#__PURE__*/_jsx(\"small\",{style:{color:'#ffc107',display:'block',marginTop:'2px'},children:\"\\uD83D\\uDD0D Verificando SKU...\"}),editSkuValidation.isAvailable===false&&/*#__PURE__*/_jsxs(\"small\",{style:{color:'#dc3545',display:'block',marginTop:'2px'},children:[\"\\u274C \",editSkuValidation.message]}),editSkuValidation.isAvailable===true&&/*#__PURE__*/_jsxs(\"small\",{style:{color:'#28a745',display:'block',marginTop:'2px'},children:[\"\\u2705 \",editSkuValidation.message]}),editSkuValidation.error&&/*#__PURE__*/_jsxs(\"small\",{style:{color:'#dc3545',display:'block',marginTop:'2px'},children:[\"\\u26A0\\uFE0F \",editSkuValidation.error]})]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Nombre del Producto (ej: Funda iPhone 14)\",value:editingProduct.name,onChange:e=>setEditingProduct(_objectSpread(_objectSpread({},editingProduct),{},{name:e.target.value})),required:true}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",placeholder:\"Precio Costo en COP (ej: 15000)\",value:editingProduct.cost_price,onChange:e=>setEditingProduct(_objectSpread(_objectSpread({},editingProduct),{},{cost_price:parseFloat(e.target.value)})),required:true}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",placeholder:\"Precio Venta en COP (ej: 25000)\",value:editingProduct.selling_price,onChange:e=>setEditingProduct(_objectSpread(_objectSpread({},editingProduct),{},{selling_price:parseFloat(e.target.value)})),required:true}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",placeholder:\"Cantidad en Stock (ej: 50)\",value:editingProduct.stock_quantity,onChange:e=>setEditingProduct(_objectSpread(_objectSpread({},editingProduct),{},{stock_quantity:parseInt(e.target.value)})),required:true}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'10px'},children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:isLoading||editSkuValidation.isAvailable===false||editSkuValidation.isValidating,style:{padding:'8px 16px',backgroundColor:editSkuValidation.isAvailable===false?'#6c757d':'#28a745',color:'white',border:'none',borderRadius:'4px',cursor:editSkuValidation.isAvailable===false?'not-allowed':'pointer',opacity:editSkuValidation.isAvailable===false?0.6:1},children:isLoading?'Guardando...':editSkuValidation.isAvailable===false?'SKU no disponible':'Guardar Cambios'}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>{setEditingProduct(null);editSkuValidation.clearValidation();},style:{padding:'8px 16px',backgroundColor:'#6c757d',color:'white',border:'none',borderRadius:'4px',cursor:'pointer'},children:\"Cancelar\"})]})]})]})]});};export default InventoryPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}