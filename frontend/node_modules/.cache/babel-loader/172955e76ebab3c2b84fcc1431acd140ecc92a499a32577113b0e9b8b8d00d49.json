{"ast":null,"code":"// ==================================================================\n// POINT OF SALE - VERSIÓN LIMPIA Y COMPILABLE\n// ==================================================================\nimport React,{useState,useEffect}from'react';import{useAppDispatch,useAppSelector}from'../hooks/useAppDispatch';import{useDebounce}from'../hooks/useDebounce';import{searchProducts,setQuery,clearSearch}from'../store/slices/searchSlice';import{addToCart,removeFromCart,clearCart}from'../store/slices/cartSlice';import{processSale,clearSuccessMessage}from'../store/slices/saleSlice';import{PaymentGateway}from'../components/POS/PaymentGateway';import'../styles/pos.css';import'../styles/paymentGateway.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const POSClean=()=>{const dispatch=useAppDispatch();// Estados locales\nconst[searchQuery,setSearchQuery]=useState('');const[cartKey,setCartKey]=useState(0);const[showPaymentGateway,setShowPaymentGateway]=useState(false);// Selectores de estado Redux\nconst{results,isLoading:searchLoading,error:searchError}=useAppSelector(state=>state.search);const{items:cartItems,totalAmount,totalItems}=useAppSelector(state=>state.cart);const{isProcessing,error:saleError,successMessage}=useAppSelector(state=>state.sale);// Debounce para optimizar búsquedas\nconst debouncedQuery=useDebounce(searchQuery,300);// Efecto para búsqueda automática\nuseEffect(()=>{dispatch(setQuery(debouncedQuery));if(debouncedQuery.trim()){dispatch(searchProducts(debouncedQuery));}else{dispatch(clearSearch());}},[debouncedQuery,dispatch]);// Efecto para monitorear cambios en el carrito\nuseEffect(()=>{console.log('🛒 Estado del carrito actualizado:',{items:cartItems.length,totalAmount,totalItems,cartKey});},[cartItems,totalAmount,totalItems,cartKey]);// Efecto para monitorear cambios en showPaymentGateway\nuseEffect(()=>{console.log('💳 showPaymentGateway cambió a:',showPaymentGateway);},[showPaymentGateway]);// Limpiar mensaje de éxito\nuseEffect(()=>{if(successMessage){const timer=setTimeout(()=>{dispatch(clearSuccessMessage());},3000);return()=>clearTimeout(timer);}},[successMessage,dispatch]);// Handlers\nconst handleSearchChange=e=>{setSearchQuery(e.target.value);};const handleAddToCart=product=>{console.log('🎯 handleAddToCart llamado con:',product);dispatch(addToCart(product));console.log('🎯 Dispatch completado');};const handleRemoveFromCart=productId=>{dispatch(removeFromCart(productId));};const handleFinalizeSale=()=>{console.log('🚀 handleFinalizeSale ejecutándose');console.log('🛒 Items en carrito:',cartItems.length);console.log('🔍 showPaymentGateway actual:',showPaymentGateway);if(cartItems.length===0){console.log('❌ Carrito vacío, no se puede finalizar venta');return;}console.log('✅ Abriendo pasarela de pago');setShowPaymentGateway(true);console.log('✅ setShowPaymentGateway(true) ejecutado');};const handlePaymentConfirm=async paymentData=>{const saleData={user_id:1,items:cartItems.map(item=>({product_id:item.id,quantity_sold:item.quantity_in_cart,price_at_time_of_sale:item.selling_price})),total_amount:totalAmount,payment_method:paymentData.method,payment_details:paymentData};const result=await dispatch(processSale(saleData));if(processSale.fulfilled.match(result)){dispatch(clearCart());setSearchQuery('');dispatch(clearSearch());setCartKey(prev=>prev+1);setShowPaymentGateway(false);// Mostrar recibo o confirmación\nalert(\"Venta completada exitosamente!\\nM\\xE9todo: \".concat(paymentData.method,\"\\nTotal: $\").concat(totalAmount.toLocaleString('es-CO')));}};const handlePaymentCancel=()=>{setShowPaymentGateway(false);};return/*#__PURE__*/_jsxs(\"div\",{className:\"pos-page\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Punto de Venta\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"pos-layout\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"pos-left-panel\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"search-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"search-input-container\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Buscar producto por nombre o SKU...\",value:searchQuery,onChange:handleSearchChange,className:\"search-input\"}),/*#__PURE__*/_jsx(\"button\",{className:\"search-button\",disabled:!searchQuery.trim()||searchLoading,children:searchLoading?'Buscando...':'Buscar'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"search-results\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Resultados de B\\xFAsqueda\"}),searchLoading?/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"Buscando productos...\"}):results.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"no-results\",children:\"No hay resultados.\"}):/*#__PURE__*/_jsx(\"div\",{className:\"results-list\",children:results.map(product=>/*#__PURE__*/_jsxs(\"div\",{className:\"product-item\",onClick:()=>handleAddToCart(product),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"product-info\",children:[/*#__PURE__*/_jsx(\"h4\",{children:product.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"product-sku\",children:[\"SKU: \",product.sku]}),/*#__PURE__*/_jsxs(\"p\",{className:\"product-price\",children:[\"$\",product.selling_price.toLocaleString('es-CO')]}),/*#__PURE__*/_jsxs(\"p\",{className:\"product-stock\",children:[\"Stock: \",product.stock_quantity]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"add-button\",children:\"Agregar\"})]},product.id))})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"pos-right-panel\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"cart-section\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"Carrito de Compras (\",totalItems,\" productos)\"]}),cartItems.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"empty-cart\",children:/*#__PURE__*/_jsx(\"p\",{children:\"El carrito est\\xE1 vac\\xEDo.\"})}):/*#__PURE__*/_jsx(\"div\",{className:\"cart-items\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"cart-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Producto\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Cantidad\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Precio Unit.\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Subtotal\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Acci\\xF3n\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:cartItems.map(item=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"product-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"product-name\",children:item.name}),/*#__PURE__*/_jsxs(\"small\",{className:\"product-sku\",children:[\"SKU: \",item.sku]})]})}),/*#__PURE__*/_jsx(\"td\",{className:\"quantity\",children:item.quantity_in_cart}),/*#__PURE__*/_jsxs(\"td\",{className:\"price\",children:[\"$\",item.selling_price.toLocaleString('es-CO')]}),/*#__PURE__*/_jsxs(\"td\",{className:\"subtotal\",children:[\"$\",(item.selling_price*item.quantity_in_cart).toLocaleString('es-CO')]}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleRemoveFromCart(item.id),className:\"remove-button\",children:\"Eliminar\"})})]},\"\".concat(item.id,\"-\").concat(cartKey)))})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"cart-total\",children:/*#__PURE__*/_jsxs(\"h3\",{children:[\"Total: $\",totalAmount.toLocaleString('es-CO')]})})]},\"cart-section-\".concat(cartKey)),/*#__PURE__*/_jsx(\"div\",{className:\"sale-actions\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>{console.log('🎯 Botón Finalizar Venta clickeado');console.log('🛒 Items en carrito:',cartItems.length);console.log('💰 Total:',totalAmount);handleFinalizeSale();},disabled:cartItems.length===0||isProcessing,className:\"finalize-sale-button \".concat(cartItems.length>0&&!isProcessing?'enabled':'disabled'),children:isProcessing?'Procesando venta...':'Finalizar Venta'})}),/*#__PURE__*/_jsxs(\"div\",{className:\"status-messages\",children:[successMessage&&/*#__PURE__*/_jsxs(\"div\",{className:\"message success\",children:[\"\\u2705 \",successMessage]}),saleError&&/*#__PURE__*/_jsxs(\"div\",{className:\"message error\",children:[\"\\u274C \",saleError]}),searchError&&/*#__PURE__*/_jsxs(\"div\",{className:\"message error\",children:[\"\\uD83D\\uDD0D Error en b\\xFAsqueda: \",searchError]})]})]})]}),showPaymentGateway&&/*#__PURE__*/_jsx(PaymentGateway,{cartItems:cartItems,totalAmount:totalAmount,onConfirmPayment:handlePaymentConfirm,onCancel:handlePaymentCancel})]});};export default POSClean;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}