{"ast":null,"code":"import React,{useState}from'react';import{getDistributorLoansByAccessCode,postConsignmentReport,loginDistributor}from'../services/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const DistributorPortalPage=()=>{const[accessCode,setAccessCode]=useState('');const[distributorId,setDistributorId]=useState(null);const[loans,setLoans]=useState([]);const[error,setError]=useState(null);const[username,setUsername]=useState('');// Para el nombre del distribuidor\nconst handleLogin=async e=>{e.preventDefault();setError(null);try{console.log('🔐 Iniciando login distribuidor:',username,accessCode);// Autenticar al distribuidor para obtener un token\nconst authData=await loginDistributor(username,accessCode);console.log('✅ Login exitoso:',authData);localStorage.setItem('distributorAuthToken',authData.access_token);// Guardar token\nconsole.log('📋 Obteniendo préstamos...');// Obtener los préstamos usando el token y el ID del distribuidor (que podría venir en el token)\n// Por ahora, asumimos que el ID del distribuidor se puede obtener de alguna manera\n// o que el endpoint de préstamos no requiere el ID si el token lo contiene.\n// Para este ejemplo, asumiremos que el ID del distribuidor es 1 para pruebas.\n// En un escenario real, el token JWT del distribuidor debería contener su ID.\nconst fetchedLoans=await getDistributorLoansByAccessCode(accessCode);// Pasamos el accessCode para simular la búsqueda\nconsole.log('✅ Préstamos obtenidos:',fetchedLoans);setLoans(fetchedLoans.loans);setDistributorId(fetchedLoans.distributor.id);// Obtenemos el ID del distribuidor de la respuesta\n}catch(err){console.error('❌ Error en login distribuidor:',err);setError(err.message||\"Código de acceso o nombre de distribuidor inválido.\");setDistributorId(null);setLoans([]);}};if(!distributorId){return/*#__PURE__*/_jsxs(\"div\",{style:{padding:'20px'},children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Portal de Distribuidores\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleLogin,children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'10px'},children:[/*#__PURE__*/_jsx(\"label\",{children:\"Nombre de Distribuidor:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:username,onChange:e=>setUsername(e.target.value),required:true,style:{marginLeft:'10px'}})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'10px'},children:[/*#__PURE__*/_jsx(\"label\",{children:\"C\\xF3digo de Acceso:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:accessCode,onChange:e=>setAccessCode(e.target.value),required:true,style:{marginLeft:'10px'}})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Ingresar\"}),error&&/*#__PURE__*/_jsx(\"p\",{style:{color:'red'},children:error})]})]});}return/*#__PURE__*/_jsxs(\"div\",{style:{padding:'20px'},children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\"Bienvenido, Distribuidor (ID: \",distributorId,\")\"]}),/*#__PURE__*/_jsx(\"h2\",{children:\"Sus Pr\\xE9stamos Activos\"}),loans.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"No tiene pr\\xE9stamos activos.\"}):loans.filter(loan=>loan.status==='en_prestamo').map(loan=>/*#__PURE__*/_jsx(LoanReportForm,{loan:loan},loan.id))]});};const LoanReportForm=_ref=>{var _loan$product;let{loan}=_ref;const[sold,setSold]=useState(0);const[returned,setReturned]=useState(0);const[error,setError]=useState(null);const[success,setSuccess]=useState(null);const handleSubmit=async e=>{e.preventDefault();setError(null);setSuccess(null);if(sold+returned>loan.quantity_loaned){setError(\"La cantidad vendida y devuelta no puede superar la cantidad prestada.\");return;}try{await postConsignmentReport({loan_id:loan.id,quantity_sold:sold,quantity_returned:returned,report_date:new Date().toISOString().split('T')[0]// Formato YYYY-MM-DD\n});setSuccess(\"Reporte enviado con éxito.\");// Opcional: Actualizar el estado del préstamo o recargar la lista\n}catch(err){setError(\"Error al enviar el reporte: \".concat(err.message,\".\"));}};return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,style:{border:'1px solid #ccc',padding:'15px',margin:'10px 0'},children:[/*#__PURE__*/_jsxs(\"h4\",{children:[\"Producto: \",((_loan$product=loan.product)===null||_loan$product===void 0?void 0:_loan$product.name)||\"ID: \".concat(loan.product_id)]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Cantidad Prestada: \",loan.quantity_loaned]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Cantidad Vendida: \"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:sold,onChange:e=>setSold(parseInt(e.target.value,10)),min:\"0\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Cantidad Devuelta: \"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:returned,onChange:e=>setReturned(parseInt(e.target.value,10)),min:\"0\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Enviar Reporte\"}),error&&/*#__PURE__*/_jsx(\"p\",{style:{color:'red'},children:error}),success&&/*#__PURE__*/_jsx(\"p\",{style:{color:'green'},children:success})]});};export default DistributorPortalPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}